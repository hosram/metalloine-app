<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Metalloine | لیست بانک‌های حسابفا</title>

<!-- فونت Vazirmatn -->
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003.4/Farsi-font-face.css">

<style>
:root{--c1:#8E1F61;--c2:#8FA2B2;--glass:rgba(255,255,255,.1);--r:22px}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:"Vazirmatn",sans-serif;line-height:1.6}
#topbar{display:flex;justify-content:center;align-items:center;height:64px;margin:12px;
  background:var(--glass);backdrop-filter:blur(24px);
  border:1px solid rgba(255,255,255,.25);border-radius:var(--r)}
.logo{display:flex;align-items:center;gap:8px;font-size:1.4rem;font-weight:700}
.ring{width:22px;height:22px;border:6px solid var(--c2);border-radius:50%}
.brand{color:var(--c1)}
main{max-width:500px;margin:0 auto;padding:12px}
.card{background:var(--glass);backdrop-filter:blur(24px);border-radius:var(--r);
  border:1px solid rgba(255,255,255,.2);padding:16px;margin-top:12px}
.card h2{text-align:center;margin-bottom:8px;font-size:1.2rem}
.card p{margin-bottom:12px}
.btn{display:inline-block;padding:10px 18px;border-radius:8px;border:none;cursor:pointer;
  background:linear-gradient(135deg,var(--c1),var(--c2));color:#fff;font-weight:700}
.btn:hover{opacity:.9}
.loader{display:inline-block;width:18px;height:18px;border:3px solid #fff;border-top-color:transparent;
  border-radius:50%;animation:spin 1s linear infinite;margin-right:6px;vertical-align:-2px}
@keyframes spin{to{transform:rotate(360deg)}}
.status{margin-top:10px;color:#ff8080;min-height:1.2em}
.bank-list{display:flex;flex-direction:column;gap:12px;margin-top:14px}
.bank-row{display:flex;justify-content:space-between;align-items:center;background:#111;
  border-radius:var(--r);padding:10px 14px;border:1px solid rgba(255,255,255,.2)}
.bank-balance{color:#56ff56;font-weight:700}
</style>
</head>

<body>
<header id="topbar">
  <span class="logo"><span class="ring"></span><span class="brand">Metalloine</span></span>
</header>

<main>
  <div class="card">
    <h2>لیست بانک‌های حسابفا</h2>
    <p>روی دکمه کلیک کنید تا حساب‌های بانکی و موجودی فعلی آن‌ها نمایش داده شود.</p>

    <button id="loadBtn" class="btn">دریافت لیست بانک‌ها</button>
    <div id="status" class="status"></div>

    <div id="bankList" class="bank-list"></div>
  </div>
</main>

<script>
/* ============== کلیدها ============== */
const API_KEY     = "XYeyCb0ImFsL8hr97IjLcJyBy7NImVm4";
const LOGIN_TOKEN = "09a16a9e8feb473bacb8ccfe1a0b2ecac9798d486193bac994022ba9e4697524d5b8de6dec5ad2af79cbae77d4ca2af0";

/* ============== مسیر رسمی حسابفا (v1/BankAccount/GetAll) ============== */
const BANKS_URL   = "https://api.hesabfa.com/v1/BankAccount/GetAll";

/* ============== المان‌ها ============== */
const statusEl = document.getElementById("status");
const listEl   = document.getElementById("bankList");
const btn      = document.getElementById("loadBtn");

/* ============== رویداد کلیک ============== */
btn.addEventListener("click", async () => {
  listEl.innerHTML = "";
  statusEl.innerHTML = '<span class="loader"></span>در حال دریافت...';

  const body = JSON.stringify({ apiKey: API_KEY, token: LOGIN_TOKEN });

  try {
    const res = await fetch(BANKS_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body
    });

    if (!res.ok) throw new Error("کد پاسخ " + res.status);

    const json = await res.json();
    const banks = json.Result || [];

    if (!Array.isArray(banks) || !banks.length) {
      statusEl.textContent = "هیچ حساب بانکی برنگشت!";
      return;
    }

    banks.forEach(b => {
      /* فیلدهای معمول در خروجی حسابفا */
      const name = b.Title   || b.bankName || "—";
      const bal  = b.Balance || b.balance  || 0;

      const row = document.createElement("div");
      row.className = "bank-row";
      row.innerHTML =
        `<span>${name}</span>
         <span class="bank-balance">${bal.toLocaleString("fa-IR")} ریال</span>`;
      listEl.appendChild(row);
    });
    statusEl.textContent = "";
  } catch (e) {
    console.error(e);
    statusEl.textContent =
      "خطا: " + e.message +
      " — اگر در کنسول پیغام CORS دیدید، باید از یک سرور واسط استفاده کنید.";
  }
});
</script>
</body>
</html>
