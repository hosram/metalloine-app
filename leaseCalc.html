<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Metalloine | محاسبۀ لیزینگ فلزات ۱٫۳</title>

  <!-- قلم Vazirmatn -->
  <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003.4/Farsi-font-face.css"/>

  <style>
  :root{--c1:#8E1F61;--c2:#8FA2B2;--glass:rgba(255,255,255,.08);--r:24px;--g:12px}
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:#000;color:#fff;font-family:"Vazirmatn",sans-serif;line-height:1.6}

  /* هدر */
  header{display:flex;justify-content:center;align-items:center;height:64px;margin:var(--g);
    background:var(--glass);backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,.25);border-radius:var(--r)}
  .ring{width:22px;height:22px;border:6px solid var(--c2);border-radius:50%}
  .brand{margin-inline-start:8px;font-size:1.4rem;font-weight:700;color:var(--c1)}

  /* بدنه */
  main{max-width:820px;margin:0 auto;padding:var(--g)}
  .card{background:var(--glass);backdrop-filter:blur(24px);
    border:1px solid rgba(255,255,255,.2);border-radius:var(--r);padding:16px;margin-bottom:var(--g)}
  label{display:flex;flex-direction:column;gap:4px;margin-block:8px;font-size:.85rem}
  input[type=text],input[type=range]{background:#222;border:none;border-radius:var(--r);
    color:#fff;padding:10px;font:inherit;direction:ltr}
  .btn{cursor:pointer;border:none;border-radius:var(--r);padding:12px 24px;
    background:linear-gradient(135deg,var(--c1),var(--c2));color:#fff;font-weight:600;
    box-shadow:0 3px 8px rgba(0,0,0,.4)}
  .btn:hover{transform:translateY(-2px)}
  @media(max-width:540px){.btn{width:100%}}
  table{width:100%;border-collapse:collapse;margin-top:16px;font-size:.9rem}
  th,td{border:1px solid rgba(255,255,255,.25);padding:6px;text-align:center}
  th{white-space:nowrap}
  .sep{text-align:right}
  footer{text-align:center;font-size:.8rem;opacity:.7;padding:.6rem 0}
  </style>
</head>
<body>

<header><span class="ring"></span><span class="brand">Metalloine</span></header>

<main>

<div class="card">
  <h3>فرم محاسبۀ لیزینگ فلزات</h3>

  <label>وزن قطعه (کیلوگرم)
    <input id="w"  class="sep" placeholder="120"/>
  </label>
  <label>قیمت هر کیلو (تومان)
    <input id="pk" class="sep" placeholder="95,000"/>
  </label>
  <label>تعداد برش
    <input id="cuts" class="sep" placeholder="3"/>
  </label>
  <label>قیمت هر برش (تومان)
    <input id="pc" class="sep" placeholder="12,000"/>
  </label>
  <label>درصد پیش‌پرداخت
    <input type="range" id="dp" min="0" max="100" value="50"/>
    <span id="dpVal">۵۰٪</span>
  </label>
  <label>برآورد تغییر دلار بر هر کیلو (تومان)
    <input id="dKg" class="sep" placeholder="+4,000 یا -2,000"/>
  </label>

  <button class="btn" id="calc">محاسبه</button>

  <div id="out" style="margin-top:1rem"></div>
</div>

</main>
<footer>© 2025 Metalloine — نسخه ۱٫۳</footer>

<script>
/* تبدیل ارقام فارسی/عربی به لاتین */
const fa2en=s=>s.replace(/[۰-۹]/g,d=>"۰۱۲۳۴۵۶۷۸۹".indexOf(d))
                .replace(/[٠-٩]/g,d=>"٠١٢٣٤٥٦٧٨٩".indexOf(d));
/* جداکنندۀ سه‌رقمی زنده */
document.querySelectorAll(".sep").forEach(el=>{
 el.addEventListener("input",()=>{const p=el.selectionStart,l=el.value.length;
  const neg=el.value.trim().startsWith("-"),c=fa2en(el.value).replace(/\D/g,"");
  el.value=(neg?"-":"")+(c?parseInt(c,10).toLocaleString("en-US"):"");
  el.selectionEnd=p+(el.value.length-l);
 });
});
/* کمک‌ها */
const sep=n=>(+n||0).toLocaleString("en-US");
const raw=s=>parseInt(fa2en(s).replace(/\D/g,"")||"0",10);
/* اسلایدر */
dp.oninput=_=>dpVal.textContent=dp.value+"٪";
/* سود ماهانه */
const r=0.07,
      grow=(x,m)=>Math.round(x*Math.pow(1+r,m)),
      withDP=(b,p,m)=>Math.round(b*p/100+(b-b*p/100)*Math.pow(1+r,m));

/* محاسبه */
document.getElementById("calc").addEventListener("click",()=>{
  const w  = raw(w.value),
        pk = raw(pk.value),
        cN = raw(cuts.value),
        pc = raw(pc.value),
        dpP= +dp.value,
        dkg= raw(dKg.value)*(dKg.value.trim().startsWith("-")?-1:1);

  if(!w||!pk){alert("وزن و قیمت هر کیلو الزامی است");return;}

  /* هزینه‌های پایه و با دلتا */
  const metal   = w*pk,
        cutCost = cN*pc,
        base    = metal+cutCost,
        metalΔ  = w*(pk+dkg),
        baseΔ   = metalΔ+cutCost;

  /* گزینه‌ها (مجموع با Δ دلار) */
  const opts=[
    ["نقدی",               baseΔ],
    ["۱ ماه بدون پیش‌پرداخت",      grow(baseΔ,1)],
    [`۱ ماه با پیش‌پرداخت ${dpP}%`,withDP(baseΔ,dpP,1)],
    ["۲ ماه بدون پیش‌پرداخت",      grow(baseΔ,2)],
    [`۲ ماه با پیش‌پرداخت ${dpP}%`,withDP(baseΔ,dpP,2)]
  ];

  /* جدول فی هر کیلو و فی هر برش */
  const colRows=opts.map(o=>{
     const perKg  = o[1]/w;
     const perCut = cN? o[1]/cN : 0;
     return `<tr><td>${o[0]}</td><td>${sep(Math.round(perKg))}</td><td>${sep(Math.round(perCut))}</td></tr>`;
  }).join("");

  const t=`<table>
  <thead><tr><th>نوع پرداخت</th><th>فی هر کیلو (تومان)</th><th>فی هر برش (تومان)</th></tr></thead>
  <tbody>${colRows}</tbody></table>`;

  document.getElementById("out").innerHTML=t+
    `<p style="margin-top:6px;font-size:.85rem">Δ دلار بر هر kg: ${sep(dkg)} تومان</p>`;
});
</script>
</body>
</html>
