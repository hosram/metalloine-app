<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Metalloine | Ù„ÛŒØ²ÛŒÙ†Ú¯ (Ù†Ø³Ø®Û€ Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ)</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003.4/Farsi-font-face.css"/>

<!-- React + Recharts UMD -->
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>

<style>
:root{--c-primary:#8E1F61;--c-accent:#8FA2B2;--glass:rgba(255,255,255,.08);--r:24px;--g:12px}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:"Vazirmatn",sans-serif;line-height:1.6}

header{display:flex;justify-content:center;align-items:center;height:64px;margin:var(--g);
  background:var(--glass);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.25);border-radius:var(--r)}
.ring{width:22px;height:22px;border:6px solid var(--c-accent);border-radius:50%}
.brand{margin-inline-start:8px;font-size:1.4rem;font-weight:700;color:var(--c-primary)}

main{max-width:900px;margin:0 auto;padding:var(--g);display:grid;gap:var(--g)}
.card{background:var(--glass);backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.2);
  border-radius:var(--r);padding:16px}
label{display:flex;flex-direction:column;gap:4px;margin-block:8px;font-size:.85rem}
input[type=number],input[type=text],input[type=range]{background:#222;border:none;border-radius:var(--r);
  color:#fff;padding:10px;font:inherit;direction:ltr}
.btn{cursor:pointer;border:none;border-radius:var(--r);padding:12px 24px;
  background:linear-gradient(135deg,var(--c-primary),var(--c-accent));
  color:#fff;font-weight:600;box-shadow:0 3px 8px rgba(0,0,0,.4)}
.btn:hover{transform:translateY(-2px)}
table{width:100%;border-collapse:collapse;margin-top:12px;font-size:.9rem}
th,td{border:1px solid rgba(255,255,255,.2);padding:6px;text-align:center}
#chartBox{height:260px}
.sep{text-align:right}
footer{text-align:center;font-size:.8rem;opacity:.7;padding:.7rem 0}
@media(max-width:540px){.btn{width:100%}}
</style>
</head>
<body>

<header><span class="ring"></span><span class="brand">Metalloine</span></header>

<main>

<!-- Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø³Ø§Ø¯Ù‡ -->
<div class="card" id="dash">
  <h3 style="margin-bottom:6px">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø®Ù„Ø§ØµÙ‡</h3>
  <p id="dashTotal">Ù‡ÛŒÚ† ÙØ§Ú©ØªÙˆØ±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
  <table id="dashTable" style="display:none">
    <thead><tr><th>#</th><th>Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ±</th><th>Ù†Ø³ÛŒÙ‡ Û± Ù…Ø§Ù‡ (Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´)</th></tr></thead>
    <tbody></tbody>
  </table>
</div>

<!-- ÙØ±Ù… Ù…Ø­Ø§Ø³Ø¨Ù‡ -->
<div class="card">
  <h3>ÙØ±Ù… Ù…Ø­Ø§Ø³Ø¨Ù‡Ù” Ù„ÛŒØ²ÛŒÙ†Ú¯</h3>

  <label>Ù…Ø¨Ù„Øº Ú©Ù„ÛŒ ÙØ§Ú©ØªÙˆØ± (ØªÙˆÙ…Ø§Ù†)
    <input id="invoice" class="sep" placeholder="5,000,000"/>
  </label>

  <label>Ø¯Ø±ØµØ¯ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª
    <input type="range" id="dpSlider" min="0" max="100" value="50"/>
    <span id="dpVal">ÛµÛ°Ùª</span>
  </label>

  <label>Ø¨Ø±Ø¢ÙˆØ±Ø¯ ØªØºÛŒÛŒØ± Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± (ØªÙˆÙ…Ø§Ù†) <small>(+ ÛŒØ§ -)</small>
    <input id="predict" class="sep" placeholder="+5,000 ÛŒØ§ -3,000"/>
  </label>

  <button class="btn" id="calcBtn">Ù…Ø­Ø§Ø³Ø¨Û€ Ù„ÛŒØ²ÛŒÙ†Ú¯ Ùˆ Ø«Ø¨Øª Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</button>
  <button class="btn" style="margin-top:8px;background:#444" onclick="location='index.html'">â¬… Ø¨Ø§Ø²Ú¯Ø´Øª</button>

  <div id="resultBox" style="margin-top:1rem;white-space:pre-line"></div>
</div>

<!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡ -->
<div class="card">
  <h3 style="margin-bottom:6px">Ù†Ù…ÙˆØ¯Ø§Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡Ù” Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§</h3>
  <div id="chartBox"></div>
</div>

</main>

<footer>Metalloine â€” Ù†Ø³Ø®Ù‡Ù” Ø¢Ø²Ù…Ø§ÛŒØ´ÛŒ Û±Ù«Û°Û±</footer>

<script>
/* Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ø¹Ø¯Ø¯ÛŒ */
const sep=(n)=>(+n||0).toLocaleString("en-US");
const raw=(s)=>parseInt(String(s).replace(/\D/g,"")||"0",10);

/* Ø§Ø³Ù„Ø§ÛŒØ¯Ø± Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª */
const slider=document.getElementById("dpSlider");
const dpLabel=document.getElementById("dpVal");
slider.addEventListener("input",()=>dpLabel.textContent=slider.value+"Ùª");

/* Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ù…Ø­Ù„ÛŒ */
const DB_KEY="metalloine_db";
const db=JSON.parse(localStorage.getItem(DB_KEY)||"[]");
function saveDB(){localStorage.setItem(DB_KEY,JSON.stringify(db));}

/* Ù†Ø±Ø® Ø³ÙˆØ¯ Ù…Ø§Ù‡Ø§Ù†Ù‡ */
const r=0.07;
function oneMonth(amount){return Math.round(amount*(1+r));}
function twoMonth(amount){return Math.round(amount*Math.pow(1+r,2));}
function withDP(base,dpPerc,months){
  const dp=base*dpPerc/100;
  const remain=base-dp;
  const factor=Math.pow(1+r,months);
  return Math.round(dp+remain*factor);
}

/* Ù…Ø­Ø§Ø³Ø¨Ù‡ Ùˆ Ø«Ø¨Øª */
document.getElementById("calcBtn").addEventListener("click",()=>{
  const invoice=raw(document.getElementById("invoice").value);
  const dpP=+slider.value;
  const delta=raw(document.getElementById("predict").value)* (document.getElementById("predict").value.trim().startsWith("-")?-1:1);

  if(invoice<=0){alert("Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");return;}

  // Ù…Ø­Ø§Ø³Ø¨Ø§Øª
  const cash=invoice;
  const n1=noPre=oneMonth(invoice);
  const n1dp=withDP(invoice,dpP,1);
  const n2=twoMonth(invoice);
  const n2dp=withDP(invoice,dpP,2);

  // Ù†Ø³Ø¨Øª ØªØºÛŒÛŒØ± Ø¯Ù„Ø§Ø±
  const ratio=delta? (invoice+delta)/invoice : 1;
  const n1x = Math.round(n1*ratio);
  const n1dpx=Math.round(n1dp*ratio);
  const n2x = Math.round(n2*ratio);
  const n2dpx=Math.round(n2dp*ratio);

  // Ø®Ø±ÙˆØ¬ÛŒ Ù…ØªÙ†ÛŒ
  const out=`ğŸ“„ Ù…Ø¨Ù„Øº ÙØ§Ú©ØªÙˆØ±: ${sep(invoice)} ØªÙˆÙ…Ø§Ù†
â– Ù†Ù‚Ø¯ÛŒ: ${sep(cash)} ØªÙˆÙ…Ø§Ù†
â– Û± Ù…Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª: ${sep(n1)} ØªÙˆÙ…Ø§Ù†
â– Û± Ù…Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª ${dpP}Ùª : ${sep(n1dp)} ØªÙˆÙ…Ø§Ù†
â– Û² Ù…Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª: ${sep(n2)} ØªÙˆÙ…Ø§Ù†
â– Û² Ù…Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª ${dpP}Ùª : ${sep(n2dp)} ØªÙˆÙ…Ø§Ù†
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ØªØºÛŒÛŒØ± Ø¯Ù„Ø§Ø±ÛŒ ÙØ±Ø¶ÛŒ: ${sep(delta)} â‡’ Ù†Ø³Ø¨Øª Ã—${ratio.toFixed(3)}
ğŸŸ¢ Û± Ù…Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´:  ${sep(n1x)} ØªÙˆÙ…Ø§Ù†
ğŸŸ¢ Û± Ù…Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª:  ${sep(n1dpx)} ØªÙˆÙ…Ø§Ù†
ğŸŸ¢ Û² Ù…Ø§Ù‡ Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ´:  ${sep(n2x)} ØªÙˆÙ…Ø§Ù†
ğŸŸ¢ Û² Ù…Ø§Ù‡ Ø¨Ø§ Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø®Øª:  ${sep(n2dpx)} ØªÙˆÙ…Ø§Ù†`;
  document.getElementById("resultBox").textContent=out;

  // Ø°Ø®ÛŒØ±Ù‡Ù” Ø®Ù„Ø§ØµÙ‡ Ø¯Ø± Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
  db.push({invoice,n1,ts:Date.now()});
  if(db.length>50) db.shift();
  saveDB();
  refreshDash();

  // Ú†Ø§Ø±Øª
  drawChart([
    {name:"Ù†Ù‚Ø¯ÛŒ",amt:cash},
    {name:"Û±M Ø¨Ø¯ÙˆÙ†â€ŒÙ¾ÛŒØ´",amt:n1},
    {name:`Û±M Ø¨Ø§ ${dpP}%`,amt:n1dp},
    {name:"Û²M Ø¨Ø¯ÙˆÙ†â€ŒÙ¾ÛŒØ´",amt:n2},
    {name:`Û²M Ø¨Ø§ ${dpP}%`,amt:n2dp}
  ]);
});

/* Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ */
function refreshDash(){
  const total=db.reduce((s,x)=>s+x.invoice,0);
  const dashTot=document.getElementById("dashTotal");
  dashTot.textContent="Ù…Ø¬Ù…ÙˆØ¹ ÙØ§Ú©ØªÙˆØ±Ù‡Ø§ÛŒ Ø«Ø¨Øª Ø´Ø¯Ù‡: "+sep(total)+" ØªÙˆÙ…Ø§Ù†";

  const tbody=document.querySelector("#dashTable tbody");
  tbody.innerHTML="";
  db.slice(-5).reverse().forEach((it,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${db.length-i}</td><td>${sep(it.invoice)}</td><td>${sep(it.n1)}</td>`;
    tbody.appendChild(tr);
  });
  document.getElementById("dashTable").style.display=db.length?"" :"none";
}
refreshDash();

/* Ú†Ø§Ø±Øª Ø¨Ø§ Recharts */
function drawChart(arr){
  const {BarChart,Bar,XAxis,YAxis,Tooltip,ResponsiveContainer,CartesianGrid}=Recharts;
  ReactDOM.render(
    React.createElement(ResponsiveContainer,{width:"100%",height:"100%"},
      React.createElement(BarChart,{data:arr},
        React.createElement(CartesianGrid,{strokeDasharray:"3 3",stroke:"#555"}),
        React.createElement(XAxis,{dataKey:"name",stroke:"#fff",fontSize:12}),
        React.createElement(YAxis,{stroke:"#fff",fontSize:12,tickFormatter:sep}),
        React.createElement(Tooltip,{formatter:sep}),
        React.createElement(Bar,{dataKey:"amt",fill:"#8E1F61",radius:[4,4,0,0]})
      )
    ),document.getElementById("chartBox"));
}
/* Ú†Ø§Ø±Øª Ø®Ø§Ù„ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ */
drawChart([]);
</script>
</body>
</html>
