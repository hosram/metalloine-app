<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Metalloine | لیزینگ ۱٫۰۵</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003.4/Farsi-font-face.css"/>

<style>
:root{--c-primary:#8E1F61;--c-accent:#8FA2B2;--glass:rgba(255,255,255,.08);--r:24px;--g:12px}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:"Vazirmatn",sans-serif;line-height:1.6}
header{display:flex;justify-content:center;align-items:center;height:64px;margin:var(--g);
  background:var(--glass);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.25);border-radius:var(--r)}
.ring{width:22px;height:22px;border:6px solid var(--c-accent);border-radius:50%}
.brand{margin-inline-start:8px;font-size:1.4rem;font-weight:700;color:var(--c-primary)}
main{max-width:680px;margin:0 auto;padding:var(--g)}
.card{background:var(--glass);backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.2);
  border-radius:var(--r);padding:16px}
label{display:flex;flex-direction:column;gap:4px;margin-block:8px;font-size:.85rem}
input[type=text],input[type=range]{background:#222;border:none;border-radius:var(--r);
  color:#fff;padding:10px;font:inherit;direction:ltr}
.btn{cursor:pointer;border:none;border-radius:var(--r);padding:12px 24px;
  background:linear-gradient(135deg,var(--c-primary),var(--c-accent));
  color:#fff;font-weight:600;box-shadow:0 3px 8px rgba(0,0,0,.4)}
.btn:hover{transform:translateY(-2px)}
table{width:100%;border-collapse:collapse;margin-top:14px;font-size:.9rem}
th,td{border:1px solid rgba(255,255,255,.25);padding:6px;text-align:center}
.sep{text-align:right}
footer{text-align:center;font-size:.8rem;opacity:.7;padding:.6rem 0}
@media(max-width:540px){.btn{width:100%}}
</style>
</head>
<body>

<header><span class="ring"></span><span class="brand">Metalloine</span></header>

<main>
<div class="card">
  <h3>محاسبۀ لیزینگ فلزات</h3>

  <label>مبلغ کلی فاکتور (تومان)
    <input id="invoice" class="sep" placeholder="5,000,000"/>
  </label>

  <label>درصد پیش‌پرداخت
    <input type="range" id="dpSlider" min="0" max="100" value="50"/>
    <span id="dpVal">۵۰٪</span>
  </label>

  <label>برآورد تغییر قیمت دلار (تومان)
    <input id="predict" class="sep" placeholder="+5,000 یا -3,000"/>
  </label>

  <button class="btn" id="calcBtn">محاسبه</button>
  <button class="btn" style="margin-top:8px;background:#444" onclick="location='index.html'">⬅ بازگشت</button>

  <div id="resultBox" style="margin-top:1rem;"></div>
</div>
</main>

<footer>Metalloine — نسخه ۱٫۰۵</footer>

<script>
/* جداکنندۀ آنی سه‌رقمی */
function format(el){
  const pos=el.selectionStart,len=el.value.length;
  const neg=el.value.trim().startsWith("-");
  const num=el.value.replace(/\D/g,"");
  el.value=(neg?"-":"")+(num?parseInt(num,10).toLocaleString("en-US"):"");
  el.selectionEnd=pos+(el.value.length-len);
}
document.querySelectorAll(".sep").forEach(el=>el.addEventListener("input",()=>format(el)));

const sep=n=>(+n||0).toLocaleString("en-US");
const raw=s=>parseInt(String(s).replace(/\D/g,"")||"0",10);

/* اسلایدر */
dpSlider.oninput=()=>dpVal.textContent=dpSlider.value+"٪";

/* نرخ سود */
const r=0.07,
      oneM=a=>Math.round(a*(1+r)),
      twoM=a=>Math.round(a*Math.pow(1+r,2)),
      withDP=(b,p,m)=>Math.round(b*p/100+(b-b*p/100)*Math.pow(1+r,m));

/* محاسبه */
calcBtn.onclick=()=>{
  const invoiceVal=document.getElementById("invoice").value;
  const invoice=raw(invoiceVal);
  if(!invoice){alert("مبلغ فاکتور را وارد کنید!");return;}

  const dp=+dpSlider.value;
  const deltaStr=predict.value.trim();
  const delta=raw(deltaStr)*(deltaStr.startsWith("-")?-1:1);

  const cash = invoice;
  const n1   = oneM(invoice);
  const n1dp = withDP(invoice,dp,1);
  const n2   = twoM(invoice);
  const n2dp = withDP(invoice,dp,2);

  const ratio=delta? (invoice+delta)/invoice : 1;
  const n1x  = Math.round(n1*ratio);
  const n1dpx= Math.round(n1dp*ratio);
  const n2x  = Math.round(n2*ratio);
  const n2dpx= Math.round(n2dp*ratio);

  resultBox.innerHTML=
`<table>
<thead><tr><th>نوع پرداخت</th><th>مبلغ (تومان)</th><th>با تغییر دلار</th></tr></thead>
<tbody>
<tr><td>نقدی</td><td>${sep(cash)}</td><td>${sep(Math.round(cash*ratio))}</td></tr>
<tr><td>۱ ماه بدون پیش</td><td>${sep(n1)}</td><td>${sep(n1x)}</td></tr>
<tr><td>۱ ماه با پیش ${dp}%</td><td>${sep(n1dp)}</td><td>${sep(n1dpx)}</td></tr>
<tr><td>۲ ماه بدون پیش</td><td>${sep(n2)}</td><td>${sep(n2x)}</td></tr>
<tr><td>۲ ماه با پیش ${dp}%</td><td>${sep(n2dp)}</td><td>${sep(n2dpx)}</td></tr>
</tbody>
</table>
<p style="margin-top:6px;font-size:.85rem">
تغییر دلار فرضی: ${sep(delta)} تومان (ضریب ×${ratio.toFixed(3)})
</p>`;
};
</script>
</body>
</html>
