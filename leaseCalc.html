<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Metalloine | محاسبۀ لیزینگ فلزات ۱٫۱</title>

<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/vazirmatn@33.003.4/Farsi-font-face.css"/>

<style>
:root{--c-primary:#8E1F61;--c-accent:#8FA2B2;--glass:rgba(255,255,255,.08);--r:24px;--g:12px}
*{box-sizing:border-box;margin:0;padding:0}
body{background:#000;color:#fff;font-family:"Vazirmatn",sans-serif;line-height:1.6}
header{display:flex;justify-content:center;align-items:center;height:64px;margin:var(--g);
  background:var(--glass);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.25);border-radius:var(--r)}
.ring{width:22px;height:22px;border:6px solid var(--c-accent);border-radius:50%}
.brand{margin-inline-start:8px;font-size:1.4rem;font-weight:700;color:var(--c-primary)}
main{max-width:750px;margin:0 auto;padding:var(--g)}
.card{background:var(--glass);backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,.2);
  border-radius:var(--r);padding:16px}
label{display:flex;flex-direction:column;gap:4px;margin-block:8px;font-size:.85rem}
input[type=text],input[type=number],input[type=range]{background:#222;border:none;border-radius:var(--r);
  color:#fff;padding:10px;font:inherit;direction:ltr}
.btn{cursor:pointer;border:none;border-radius:var(--r);padding:12px 24px;
  background:linear-gradient(135deg,var(--c-primary),var(--c-accent));
  color:#fff;font-weight:600;box-shadow:0 3px 8px rgba(0,0,0,.4)}
.btn:hover{transform:translateY(-2px)}
table{width:100%;border-collapse:collapse;margin-top:14px;font-size:.9rem}
th,td{border:1px solid rgba(255,255,255,.25);padding:6px;text-align:center}
.sep{text-align:right}
footer{text-align:center;font-size:.8rem;opacity:.7;padding:.6rem 0}
@media(max-width:540px){.btn{width:100%}}
</style>
</head>
<body>

<header><span class="ring"></span><span class="brand">Metalloine</span></header>

<main>
<div class="card">
  <h3>فرم محاسبهٔ لیزینگ فلزات</h3>

  <label>وزن قطعه (کیلوگرم)
    <input id="weight" class="sep" placeholder="120"/>
  </label>

  <label>قیمت هر کیلو (تومان)
    <input id="priceKg" class="sep" placeholder="95,000"/>
  </label>

  <label>تعداد برش
    <input id="cutCount" class="sep" placeholder="3"/>
  </label>

  <label>قیمت هر برش (تومان)
    <input id="priceCut" class="sep" placeholder="12,000"/>
  </label>

  <label>درصد پیش‌پرداخت
    <input type="range" id="dpSlider" min="0" max="100" value="50"/>
    <span id="dpVal">۵۰٪</span>
  </label>

  <label>برآورد تغییر دلار بر هر کیلو (تومان) <small>(+ یا −)</small>
    <input id="deltaKg" class="sep" placeholder="+4,000 یا -2,000"/>
  </label>

  <button class="btn" id="calcBtn">محاسبه</button>
  <button class="btn" style="margin-top:8px;background:#444" onclick="location='index.html'">⬅ بازگشت</button>

  <div id="resultBox" style="margin-top:1rem;"></div>
</div>
</main>

<footer>Metalloine — ۱٫۱</footer>

<script>
/* جداکنندهٔ زنده سه‌رقمی */
function format(el){
  const pos=el.selectionStart,len=el.value.length;
  const neg=el.value.trim().startsWith("-");
  const clean=el.value.replace(/\D/g,"");
  el.value=(neg?"-":"")+(clean?parseInt(clean,10).toLocaleString("en-US"):"");
  el.selectionEnd=pos+(el.value.length-len);
}
document.querySelectorAll(".sep").forEach(i=>i.addEventListener("input",()=>format(i)));

const sep=n=>(+n||0).toLocaleString("en-US");
const raw=s=>parseInt(String(s).replace(/\D/g,"")||"0",10);

/* نمایش درصد اسلایدر */
dpSlider.oninput=_=>dpVal.textContent=dpSlider.value+"٪";

/* نرخ سود ماهانه */
const r=0.07;
const grow=(amount,months)=>Math.round(amount*Math.pow(1+r,months));
const withDP=(base,dp,months)=>{
  const down=base*dp/100;
  return Math.round(down + (base-down)*Math.pow(1+r,months));
};

calcBtn.onclick=_=>{
  /* ورودی‌ها */
  const weight   = raw(weight.value);
  const priceKg  = raw(priceKg.value);
  const cuts     = raw(cutCount.value);
  const priceCut = raw(priceCut.value);
  const dp       = +dpSlider.value;
  const deltaStr = deltaKg.value.trim();
  const delta    = raw(deltaStr)*(deltaStr.startsWith("-")?-1:1);

  if(!weight||!priceKg){alert("وزن و قیمت هر کیلو الزامی است");return;}

  /* هزینه‌های پایه */
  const metalCost  = weight*priceKg;
  const cutCost    = cuts*priceCut;
  const baseTotal  = metalCost + cutCost;

  /* هزینه‌ها با تغییر دلار (فقط روی فلز) */
  const metalCostΔ = weight*(priceKg+delta);
  const totalΔ     = metalCostΔ + cutCost;

  /* گزینه‌های لیزینگ برای مبلغ پایه */
  const cash   = baseTotal;
  const m1np   = grow(baseTotal,1);
  const m1dp   = withDP(baseTotal,dp,1);
  const m2np   = grow(baseTotal,2);
  const m2dp   = withDP(baseTotal,dp,2);

  /* گزینه‌های لیزینگ برای مبلغ با Δ دلار */
  const cashΔ = totalΔ;
  const m1npΔ = grow(totalΔ,1);
  const m1dpΔ = withDP(totalΔ,dp,1);
  const m2npΔ = grow(totalΔ,2);
  const m2dpΔ = withDP(totalΔ,dp,2);

  /* جدول جزییات (پایه) */
  const detail=
`<table>
<thead><tr><th>جزئیات</th><th>مبلغ (تومان)</th></tr></thead>
<tbody>
<tr><td>وزن × قیمت kg</td><td>${sep(metalCost)}</td></tr>
<tr><td>تعداد برش × قیمت برش</td><td>${sep(cutCost)}</td></tr>
<tr><td><b>جمع فاکتور نقدی</b></td><td><b>${sep(cash)}</b></td></tr>
<tr><td>۱ ماه بدون پیش‌پرداخت</td><td>${sep(m1np)}</td></tr>
<tr><td>۱ ماه با پیش‌پرداخت ${dp}%</td><td>${sep(m1dp)}</td></tr>
<tr><td>۲ ماه بدون پیش‌پرداخت</td><td>${sep(m2np)}</td></tr>
<tr><td>۲ ماه با پیش‌پرداخت ${dp}%</td><td>${sep(m2dp)}</td></tr>
</tbody></table>`;

  /* جدول مقایسه با Δ دلار */
  const comp=
`<table style="margin-top:20px">
<thead><tr><th>پرداخت</th><th>مبلغ پایه</th><th>با Δ دلار</th></tr></thead>
<tbody>
<tr><td>نقدی</td><td>${sep(cash)}</td><td>${sep(cashΔ)}</td></tr>
<tr><td>۱ ماه بدون پیش</td><td>${sep(m1np)}</td><td>${sep(m1npΔ)}</td></tr>
<tr><td>۱ ماه با پیش ${dp}%</td><td>${sep(m1dp)}</td><td>${sep(m1dpΔ)}</td></tr>
<tr><td>۲ ماه بدون پیش</td><td>${sep(m2np)}</td><td>${sep(m2npΔ)}</td></tr>
<tr><td>۲ ماه با پیش ${dp}%</td><td>${sep(m2dp)}</td><td>${sep(m2dpΔ)}</td></tr>
</tbody></table>
<p style="margin-top:6px;font-size:.85rem">
Δ دلار بر هر کیلو: ${sep(delta)} تومان
</p>`;

  resultBox.innerHTML = detail + comp;
};
</script>
</body>
</html>
